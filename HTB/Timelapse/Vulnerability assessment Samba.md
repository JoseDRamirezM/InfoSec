# Vulnerability assessment Samba

Enumerate the available shares with the `smbmap` command.

![[samba_shared.png]]

I tried running `nmblookup`  to test for a null session vulnerability.

![[nullsess_try.png]]

But there was no reply from the target.

Then  I ran `enum4linux` to check what information I could get.

![[domain_name.png]]

The script prompted a lot of errors, that may indicate the presence of a firewall.

## Samba shares enumeration

### Dev

Then I went to the `Shares` directory with the `smbclient`.

![[dev_backup.png]]

Get the file

![[get_smb.png]]

Then I tried to unzip it. But it was password protected.

![[pass_protected.png]]

And I tried to crack it with `john` as follows:

1. Generate a hash with `zip2john`
	![[zip2john.png]]
2. Then run a dictionaty attack against the file password
	![[cracked_pass.png]]

The password is found `supremelegacy`. Now unzip the file.

![[pfx.png]]

The extracted file contained strings and a possible system user.

![[possible_user.png]]

But I tried to investigate the `pfx` extension to see if I could do something with the obtained file.

I found various sources that indicated that this file extension is used for Windows server certificates. More information [here](https://book.hacktricks.xyz/cryptography/certificates)

## Using the .pfx file

Poking around I came across [this](https://www.ibm.com/docs/en/arl/9.7?topic=certification-extracting-certificate-keys-from-pfx-file) article that explained how to get the certificate and the key pair with `openssl` but a password is required.

Then I found this.

![[pfx_2_john.png]]

So I generated a hash of the `.pfx` file.

![[pfx_hash.png]]

Then I tried to crack the hash with `john`.

![[pfx_pass.png]]

And I found a password. Given the password of the file retrieve the information on the file running the following commands:

1. Extract the private key

```shell
openssl pkcs12 -in [yourfile.pfx] -nocerts -out [drlive.key]
```

![[pfx_key.png]]

I entered and set the same password to the key file. A key file is generated now.

2. Extract the certificate

```shell
openssl pkcs12 -in [yourfile.pfx] -clcerts -nokeys -out [drlive.crt]
```

3. Decrypt the private key

```shell
openssl rsa -in [drlive.key] -out [drlive-decrypted.key]
```

Now I got to figure out a way to exploit the `winrm` service with the obtained information.

[[Vulnerability assessment winrm port 5986]]

### HelpDesk

This folder contained a Windows program realated to the Active Directory and may be worth looking once the foothold is obtained.

![[LAPS.png]]

