# Exploitation of the chat bot

Via the path traversal vulnerability I discovered the `dwight` system user and the bot could read the user folder.

![[bot_dwight_folder.png]]

(So there's a couple of exploits already there XD) Let's enumerate the user folder.

I found the bot credentials

![[bot_creds.png]]

export ROCKETCHAT_USER=recyclops  
export ROCKETCHAT_PASSWORD=Queenofblad3s!23

 I tried to login as the bot but it wasn't possible.

Enumerating further I came across the scripts that define the bot functionalities.

- `/home/dwight/hubot/scripts/files.js`

![[chat_bot_scripts_file.png]]

Maybe there's a way to bypass the validations and perform RCE.

After poking around and thinking nonsense I found the possible answer on the the same `/home/dwight/hubot/scripts/` folder.

There's a script called `cmd.coffee` that literally executes system commands.

![[chat_rce.png]]

Let's try to spawn a reverse shell.

# Reverse shell (foothold)

Write a payload.

![[chat_rev_shell_payload.png]]

Then I checked that wget or Curl were available to be able to transfer the payload.

![[chat_wget.png]]

It is so continue by transferring the payload. Set up a local (attacker) python HTTP server and get the payload with wget.

![[chat_transfer.png]]

Then make the payload executable, set a listener and run it.

![[chat_ch_run.png]]

And a reverse shell is obtained.

![[chat_rev_shell.png]]

Now add the attacker machine public SSH key to `/home/dwight/.ssh/authorized_keys` [How to generate key pair](https://www.siteground.com/kb/generate_ssh_key_in_linux/)

Run `echo "attacker_pub_key" >> .ssh/authorized_keys`

Make sure the permissions are correct i.e

- `chmod 700 .ssh`
- `chmod 600 authorized_keys`

And I got access via SSH

![[dwight_ssh.png]]

Capture the user flag

![[dwight_flag.png]]