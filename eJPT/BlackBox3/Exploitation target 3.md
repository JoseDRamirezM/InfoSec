# Exploitation target 3

I found an article [here](https://www.hackingarticles.in/multiple-ways-to-exploit-tomcat-manager/)that explained the process to get a reverse shell (even a Meterpreter).

Based on the article let's use the `exploit/multi/http/tomcat_mgr_upload` and configure it.

![[target3_manager_exploit.png]]

Run the exploit.

 ![[target3_tomcat_exploit_succeed.png]]

A Meterpreter session is opened as user tomcat.

I listed the folder where the session was opened and found `FLAG1`

![[target3_flag.png]]

Exploring the machine I found the `robert` user folder

![[target3_need_privesc.png]]

check /tmp folder and found nothing

Check **/etc/passwd**

![[target3_shadow.png]]

And the robert user  password hash in found. Let's try to crack it with john.

# Robert user password cracking

This path leads to the way but there's an alternative path.

# Enumerate available information
I tried to look for information on the conf folder.

![[target3_tar_conf.png]]

Then get the tar file to the attacker machine.

![[target3_download_tar.png]]

Then extract the file contents and read them.

![[target3_robert_passwd.png]]

Try the password on the system.

![[target3_robert_shell.png]]

A shell is obtained for user robert.

![[target3_robert_flag.png]]

Enumerate the user.

![[target3_sudoL.png]]


The privilege escalation vector on this machine resides in the **LD_PRELOAD** environment variable. The detailed explanation and the method to escalate privileges can be found [here](https://book.hacktricks.xyz/linux-unix/privilege-escalation#ld_preload)


![[target3_LD_PRELOAD.png]]

# LD_PRELOAD exploit

Write the exploit as explained in [here](https://book.hacktricks.xyz/linux-unix/privilege-escalation#ld_preload) 

![[target3_root_exploit.png]]

Then compile the file as follows:

![[target3_root_compile.png]]

Now execute the exploit as follows:

![[target3_root_shell.png]]

The machine is OWNED.

![[target3_root_flag.png]]

Capture the root flag.