# Exploiting blind SQL injection by triggering conditional responses

Consider the scenario of an application that uses cookies to gather analytics about usage. Requests to the application include a cookie header 

```http
Cookie: TrackingId=u5YD3PapBcR4lN3e7Tj4
```

Then the request is processed and an SQL query determines if the cookie is from a known user.

```SQL
SELECT TrackingId FROM TrackedUsers WHERE TrackingId = 'u5YD3PapBcR4lN3e7Tj4'
```

This query is vulnerable to SQL injection, but the results are not returned to the user (due to the application's logic). However, the application behaves differently depending on whether the query returns any data (the `TrackingId` was known), then a `Welcome Back` message is displayed within the page.

This behavior is enough to exploit the bling SQL injection and retrieve information. This means that a successful injection will make the application response to contain the `Welcome Back` message.

Suppose two requests containing the following `TrackingId` values are sent.

```SQL
...xyz' AND '1'='1'
...xyz' AND '1'='2'
```

The first scenario is an always true statement (that exploits the SQL injection vulnerability and the query returns results) so the application will respond with `Welcome Back`. Whereas the second scenario is a false condition and hence the application will not display the `Welcome Back` message. This allows the attacker to determine the answer to any single injected condition, and so extract data one bit at a time.

Suppose there is a table called `Users` with the columns `Username`, `Password` and the user `Administrator`. The attacker can systematically determine the password for this user by sending a series of inputs to test the password one character at a time.

To do this start to inject conditions so that each character of the password is discovered with the following payload

#SQLiPAYLOAD 
```SQL
xyz' AND SUBSTRING((SELECT Password FROM Users WHERE Username = 'Administrator'), 1, 1) > 'm
```

`Welcome Back` is not returned, indicating the injected condition is false, and so the first character of the password is greater (order wise) than `m`.

Next try with other character.

#SQLiPAYLOAD 
```SQL
xyz' AND SUBSTRING((SELECT Password FROM Users WHERE Username = 'Administrator'), 1, 1) > 't
```

`Welcome Back` is not returned so the condition is false.

Eventually the character is found (the `Welcome Back` message is displayed) by the following payload:

#SQLiPAYLOAD 
```SQL
xyz' AND SUBSTRING((SELECT Password FROM Users WHERE Username = 'Administrator'), 1, 1) = 's
```

Continue this process to determine the full password of the `Administrator User`.

Note: The SUBSTRING function is called SUBSTR on some types of databases check the [SQL injection cheat sheet](https://portswigger.net/web-security/sql-injection/cheat-sheet).

## Exploitation example

[[Blind SQL injection with conditional responses]]

